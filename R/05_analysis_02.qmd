---
title: "05. Analysing expression data: PCA"
execute: 
  echo: false
  eval: true
format: html
editor: 
  markdown: 
    wrap: 80
---

## Loading libraries

```{r}
library("tidyverse")
library("broom")
library("ggplot2")
```

## Loading the data

```{r}
cancer_data <- read_csv("../data/03_expression_tidy.csv")
cancer_data_scaled <- read_csv("../data/03_expression_scaled.csv")
```

## Computing summary statistics

```{r}
summary_stats <- cancer_data |>
  group_by(cancer) |>
  summarise_all(list(mean = mean,
                     sd = sd,
                     median = median))
```

```{r}
# Perform PCA
pca_fit <- cancer_data_scaled |>
  select(!c(1:3)) |>  # Retain only numeric columns
  prcomp(scale = FALSE)  # Perform PCA on scaled data

# Plot the data in PC coordinates
pca_plot <- pca_fit |>
  augment(cancer_data_scaled) |>
  ggplot(aes(.fittedPC1, .fittedPC2, color = cancer, size = .fittedPC3)) + 
  geom_point(alpha = 0.5) +
  scale_size(range = c(1, 8)) +
  scale_color_manual(
    values = c("ALL" = "red", "AML" = "blue")
  ) +
  labs(title = "PCA of Gene Expression by Cancer Type", 
       x = "Principal Component 1", y = "Principal Component 2",
       color = "Cancer Type") +
  theme(plot.title = element_text(hjust = 0.5))

# Display the plot
pca_plot
ggsave(filename = "05_pca.png", plot = pca_plot, device = "png", path = "../results")
```