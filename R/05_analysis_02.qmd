---
title: "05. Analysing expression data: PCA"
execute: 
  echo: false
  eval: true
format: html
editor: 
  markdown: 
    wrap: 80
---

## Loading libraries

```{r}
library("tidyverse")
library("broom")
library("ggplot2")
```

## Loading the data

```{r}
cancer_data <- read_csv("../data/03_expression_tidy.csv")
cancer_data_scaled <- read_csv("../data/03_expression_scaled.csv")
```

## Performing a PCA analysis

```{r}
pca_fit <- cancer_data_scaled |>
  select(!c(1:3)) |>  # Retain only numeric columns
  prcomp(scale = FALSE)  # Perform PCA on scaled data

pca_data <- pca_fit |>
  augment(cancer_data_scaled)

# Plotting the data in PC coordinates
pca_plot <- pca_data |> 
  ggplot(
    aes(x = .fittedPC1,
        y = .fittedPC2,
        color = cancer)
    ) + 
  geom_point(size = 2) +
  scale_color_viridis_d() +
  labs(
    title = "PCA of gene expression by cancer type", 
    x = "Principal component 1",
    y = "Principal component 2",
    color = "Cancer type"
    ) +
  theme(
    plot.title = element_text(hjust = 0.5)
    ) +
  geom_point(
    data = pca_data,
    color = "black",
    shape = "circle open",
    size = 2)

ggsave(filename = "05_pca.png",
       plot = pca_plot,
       device = "png",
       path = "../results")

pca_plot
```